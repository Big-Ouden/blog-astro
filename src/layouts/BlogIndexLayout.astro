---
import { getCollection } from "astro:content";
import BaseLayout from '@layouts/BaseLayout.astro';
import BlogPost from '@components/BlogPost.astro'

import { getLangFromUrl, useTranslations } from '@i18n/utils';


const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);


// const allPosts = await getCollection("blog");

// Filter posts by language
const allPosts = await getCollection("blog", ({ id }) => {
    return id.startsWith(`${lang}/`) || id.includes(`-${lang}.md`) || id.includes(`-${lang}/`);
});

interface Props {
    pageTitle?: String;

};

const {
    pageTitle = "Default",

} = Astro.props;

---
<BaseLayout>
    <div class="flex flex-col justify-between space-y-10  mb-5">

        <h1 class="text-3xl">{pageTitle}</h1>
    
        
        <slot name="introduction" class=""/>
    </div>

    <div id="posts-list" class="flex flex-col w-full space-y-5 mb-5 ">
    {allPosts.map((post: any) =>

        <div id="post" class="flex flex-col md:flex-row w-auto  bg-base-200">
            <div id="post-date" class="h-auto w-2/6">
                <h2>{post.data.pubDate.toLocaleDateString()}</h2>
            </div>
            <div id="post-infos" class="flex flex-col h-auto w-full">
                <div id="post-title" class=" w-auto h-auto">
                    <h1>{post.data.title}</h1>
                </div>
                <div id="post-description" class=" w-auto h-full">
                    <p>
                        {post.data.description}
                    </p>
                </div>

            </div>
            
        </div>
    )}
    </div>
    

    <!-- <ul>
        {allPosts.map((post: any) =><BlogPost url={`/posts/${post.id}`} title={post.data.title} />)}
        
    </ul> -->
    <slot name="content" />


</BaseLayout>
