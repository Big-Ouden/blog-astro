---
import { getCollection } from "astro:content";
import {Image} from "astro:assets";
import BaseLayout from '@layouts/BaseLayout.astro';
import BlogPost from '@components/BlogPost.astro'

import { getLangFromUrl, useTranslations } from '@i18n/utils';


const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);


// const allPosts = await getCollection("blog");

// Filter posts by language
const allPosts = await getCollection("blog", ({ id }) => {
    return id.startsWith(`${lang}/`) || id.includes(`-${lang}.md`) || id.includes(`-${lang}/`);
});

interface Props {
    pageTitle?: String;

};

const {
    pageTitle = "Posts",

} = Astro.props;

---
<BaseLayout>
    <div class="flex flex-col justify-between space-y-10  mb-5">

        <h1 class="text-3xl">{pageTitle}<span class="text-info">.</span></h1>


        <slot name="introduction" class=""/>
    </div>

    <div id="posts-list" class="flex flex-col w-full space-y-5 mb-5 ">
    {allPosts.map((post: any) =>

    <a href={`/posts/${post.id}`} class="hover:bg-base-200 transition-colors ">
            <div id="post" class="flex flex-col md:flex-row w-auto p-2  ">
                <div id="post-date" class="h-auto w-2/6">
                    <h2 class="text-fg-200" >{post.data.pubDate.toLocaleDateString()}</h2>


                </div>
                <div id="post-infos" class="flex flex-col h-auto w-full">
                    <div id="post-title" class=" w-auto h-auto text-xl ">
                        <h1> <span class="text-info" >#</span> <span class="underline underline-offset-5 decoration-info decoration-2 "> {post.data.title} </span> </h1>


                    </div>
                    <div id="post-description" class="text-fg-200 w-auto h-full">
                        <p>
                            {(post.data.description.length > 50) ? (

                                post.data.description.slice(0, 50) + "..."
                            ) : (
                                post.data.description
                            

                            )}
                        </p>
                    </div>

                </div>
                <div class="w-1/6 m-0 hidden md:block">
                    <div class=" flex flex-col  items-center">
                        {post.data.image && (
                            <Image 
                                src={post.data.image.url} 
                                alt=""
                                class="h-fit w-fit items-center "
                                width="50"
                            height="50"
                            loading={"lazy"}
                            />
                        )} 
                    </div>
                    
                </div>

            </div>
        </a>
    )}
    </div>


    <!-- <ul>
        {allPosts.map((post: any) =><BlogPost url={`/posts/${post.id}`} title={post.data.title} />)}

    </ul> -->
    <slot name="content" />


</BaseLayout>
